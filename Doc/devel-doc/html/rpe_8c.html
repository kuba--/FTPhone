<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//PL">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-2">
<title>rpe.c File Reference</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#fffeff">
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>rpe.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;assert.h&gt;</code><br>
<code>#include "<a class="el" href="private_8h-source.html">private.h</a>"</code><br>
<code>#include "<a class="el" href="gsm_8h-source.html">gsm.h</a>"</code><br>
<code>#include "<a class="el" href="proto_8h-source.html">proto.h</a>"</code><br>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a0">STEP</a>(i, H)&nbsp;&nbsp;&nbsp;(e[ k + i ] * H)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a1">STEP</a>(m, i)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void Weighting_filter&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a2">P2</a> ((e, x), register <a class="el" href="private_8h.html#a11">word</a> *e, <a class="el" href="private_8h.html#a11">word</a> *x)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void RPE_grid_selection&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a3">P3</a> ((x, xM, Mc_out), <a class="el" href="private_8h.html#a11">word</a> *x, <a class="el" href="private_8h.html#a11">word</a> *xM, <a class="el" href="private_8h.html#a11">word</a> *Mc_out)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void APCM_quantization_xmaxc_to_exp_mant&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a4">P3</a> ((xmaxc, exp_out, mant_out), <a class="el" href="private_8h.html#a11">word</a> xmaxc, <a class="el" href="private_8h.html#a11">word</a> *exp_out, <a class="el" href="private_8h.html#a11">word</a> *mant_out)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void APCM_quantization&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a5">P5</a> ((xM, xMc, mant_out, exp_out, xmaxc_out), <a class="el" href="private_8h.html#a11">word</a> *xM, <a class="el" href="private_8h.html#a11">word</a> *xMc, <a class="el" href="private_8h.html#a11">word</a> *mant_out, <a class="el" href="private_8h.html#a11">word</a> *exp_out, <a class="el" href="private_8h.html#a11">word</a> *xmaxc_out)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void APCM_inverse_quantization&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a6">P4</a> ((xMc, mant, exp, xMp), register <a class="el" href="private_8h.html#a11">word</a> *xMc, <a class="el" href="private_8h.html#a11">word</a> mant, <a class="el" href="private_8h.html#a11">word</a> exp, register <a class="el" href="private_8h.html#a11">word</a> *xMp)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void RPE_grid_positioning&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a7">P3</a> ((Mc, xMp, ep), <a class="el" href="private_8h.html#a11">word</a> Mc, register <a class="el" href="private_8h.html#a11">word</a> *xMp, register <a class="el" href="private_8h.html#a11">word</a> *ep)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void Gsm_RPE_Encoding&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a8">P5</a> ((S, e, xmaxc, Mc, xMc), struct <a class="el" href="structgsm__state.html">gsm_state</a> *S, <a class="el" href="private_8h.html#a11">word</a> *e, <a class="el" href="private_8h.html#a11">word</a> *xmaxc, <a class="el" href="private_8h.html#a11">word</a> *Mc, <a class="el" href="private_8h.html#a11">word</a> *xMc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void Gsm_RPE_Decoding&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="rpe_8c.html#a9">P5</a> ((S, xmaxcr, Mcr, xMcr, erp), struct <a class="el" href="structgsm__state.html">gsm_state</a> *S, <a class="el" href="private_8h.html#a11">word</a> xmaxcr, <a class="el" href="private_8h.html#a11">word</a> Mcr, <a class="el" href="private_8h.html#a11">word</a> *xMcr, <a class="el" href="private_8h.html#a11">word</a> *erp)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="rpe.c::STEP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define STEP</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">m,         <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>i&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><div class="fragment"><pre>L_temp = SASR( x[m + 3 * i], 2 );   \
                L_result += L_temp * L_temp;
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rpe.c::STEP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define STEP</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">i,         <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>H&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(e[ k + i ] * H)
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="rpe.c::P2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void Weighting_filter P2 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(e, x)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register <a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>e</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00028                                                    :
00029  *
00030  *  H[0..10] = integer( real_H[ 0..10] * 8192 ); 
00031  */
00032 {
00033     <span class="comment">/* word         wt[ 50 ]; */</span>
00034 
00035     <span class="keyword">register</span> <a class="code" href="private_8h.html#a12">longword</a>   L_result;
00036     <span class="keyword">register</span> <span class="keywordtype">int</span>        k, i;
00037 
00038     <span class="comment">/*  Initialization of a temporary working array wt[0...49]</span>
00039 <span class="comment">     */</span>
00040 
00041     <span class="comment">/* for (k =  0; k &lt;=  4; k++) wt[k] = 0;</span>
00042 <span class="comment">     * for (k =  5; k &lt;= 44; k++) wt[k] = *e++;</span>
00043 <span class="comment">     * for (k = 45; k &lt;= 49; k++) wt[k] = 0;</span>
00044 <span class="comment">     *</span>
00045 <span class="comment">     *  (e[-5..-1] and e[40..44] are allocated by the caller,</span>
00046 <span class="comment">     *  are initially zero and are not written anywhere.)</span>
00047 <span class="comment">     */</span>
00048     e -= 5;
00049 
00050     <span class="comment">/*  Compute the signal x[0..39]</span>
00051 <span class="comment">     */</span> 
00052     <span class="keywordflow">for</span> (k = 0; k &lt;= 39; k++) {
00053 
00054         L_result = 8192 &gt;&gt; 1;
00055 
00056         <span class="comment">/* for (i = 0; i &lt;= 10; i++) {</span>
00057 <span class="comment">         *  L_temp   = GSM_L_MULT( wt[k+i], gsm_H[i] );</span>
00058 <span class="comment">         *  L_result = GSM_L_ADD( L_result, L_temp );</span>
00059 <span class="comment">         * }</span>
00060 <span class="comment">         */</span>
00061 
00062 <span class="preprocessor">#undef  STEP</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define STEP( i, H )    (e[ k + i ] * H)</span>
00064 <span class="preprocessor"></span>
00065         <span class="comment">/*  Every one of these multiplications is done twice --</span>
00066 <span class="comment">         *  but I don't see an elegant way to optimize this. </span>
00067 <span class="comment">         *  Do you?</span>
00068 <span class="comment">         */</span>
00069 
00070 <span class="preprocessor">#ifdef  STUPID_COMPILER</span>
00071 <span class="preprocessor"></span>        L_result += STEP(   0,  -134 ) ;
00072         L_result += STEP(   1,  -374 )  ;
00073                    <span class="comment">/* + STEP(   2,  0    )  */</span>
00074         L_result += STEP(   3,  2054 ) ;
00075         L_result += STEP(   4,  5741 ) ;
00076         L_result += STEP(   5,  8192 ) ;
00077         L_result += STEP(   6,  5741 ) ;
00078         L_result += STEP(   7,  2054 ) ;
00079                <span class="comment">/* + STEP(   8,  0    )  */</span>
00080         L_result += STEP(   9,  -374 ) ;
00081         L_result += STEP(   10,     -134 ) ;
00082 <span class="preprocessor">#else</span>
00083 <span class="preprocessor"></span>        L_result +=
00084           STEP( 0,  -134 ) 
00085         + STEP( 1,  -374 ) 
00086          <span class="comment">/* + STEP( 2,  0    )  */</span>
00087         + STEP( 3,  2054 ) 
00088         + STEP( 4,  5741 ) 
00089         + STEP( 5,  8192 ) 
00090         + STEP( 6,  5741 ) 
00091         + STEP( 7,  2054 ) 
00092          <span class="comment">/* + STEP( 8,  0    )  */</span>
00093         + STEP( 9,  -374 ) 
00094         + STEP(10,  -134 )
00095         ;
00096 <span class="preprocessor">#endif</span>
00097 <span class="preprocessor"></span>
00098         <span class="comment">/* L_result = GSM_L_ADD( L_result, L_result ); (* scaling(x2) *)</span>
00099 <span class="comment">         * L_result = GSM_L_ADD( L_result, L_result ); (* scaling(x4) *)</span>
00100 <span class="comment">         *</span>
00101 <span class="comment">         * x[k] = SASR( L_result, 16 );</span>
00102 <span class="comment">         */</span>
00103 
00104         <span class="comment">/* 2 adds vs. &gt;&gt;16 =&gt; 14, minus one shift to compensate for</span>
00105 <span class="comment">         * those we lost when replacing L_MULT by '*'.</span>
00106 <span class="comment">         */</span>
00107 
00108         L_result = SASR( L_result, 13 );
00109         x[k] =  (  L_result &lt; <a class="code" href="private_8h.html#a0">MIN_WORD</a> ? <a class="code" href="private_8h.html#a0">MIN_WORD</a>
00110             : (L_result &gt; <a class="code" href="private_8h.html#a1">MAX_WORD</a> ? <a class="code" href="private_8h.html#a1">MAX_WORD</a> : L_result ));
00111     }
00112 }

</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="rpe.c::P3" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void RPE_grid_positioning P3 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(Mc, xMp, ep)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register <a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register <a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ep</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00402 {
00403     <span class="keywordtype">int</span> i = 13;
00404 
00405     assert(0 &lt;= Mc &amp;&amp; Mc &lt;= 3);
00406 
00407         <span class="keywordflow">switch</span> (Mc) {
00408                 <span class="keywordflow">case</span> 3: *ep++ = 0;
00409                 <span class="keywordflow">case</span> 2:  <span class="keywordflow">do</span> {
00410                                 *ep++ = 0;
00411                 <span class="keywordflow">case</span> 1:         *ep++ = 0;
00412                 <span class="keywordflow">case</span> 0:         *ep++ = *xMp++;
00413                          } <span class="keywordflow">while</span> (--i);
00414         }
00415         <span class="keywordflow">while</span> (++Mc &lt; 4) *ep++ = 0;
00416 
00417     <span class="comment">/*</span>
00418 <span class="comment"></span>
00419 <span class="comment">    int i, k;</span>
00420 <span class="comment">    for (k = 0; k &lt;= 39; k++) ep[k] = 0;</span>
00421 <span class="comment">    for (i = 0; i &lt;= 12; i++) {</span>
00422 <span class="comment">        ep[ Mc + (3*i) ] = xMp[i];</span>
00423 <span class="comment">    }</span>
00424 <span class="comment">    */</span>
00425 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="rpe.c::P3" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void APCM_quantization_xmaxc_to_exp_mant P3 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(xmaxc, exp_out, mant_out)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>xmaxc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>exp_out</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mant_out</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00228 {
00229     <a class="code" href="private_8h.html#a11">word</a>    exp, mant;
00230 
00231     <span class="comment">/* Compute exponent and mantissa of the decoded version of xmaxc</span>
00232 <span class="comment">     */</span>
00233 
00234     exp = 0;
00235     <span class="keywordflow">if</span> (xmaxc &gt; 15) exp = SASR(xmaxc, 3) - 1;
00236     mant = xmaxc - (exp &lt;&lt; 3);
00237 
00238     <span class="keywordflow">if</span> (mant == 0) {
00239         exp  = -4;
00240         mant = 7;
00241     }
00242     <span class="keywordflow">else</span> {
00243         <span class="keywordflow">while</span> (mant &lt;= 7) {
00244             mant = mant &lt;&lt; 1 | 1;
00245             exp--;
00246         }
00247         mant -= 8;
00248     }
00249 
00250     assert( exp  &gt;= -4 &amp;&amp; exp &lt;= 6 );
00251     assert( mant &gt;= 0 &amp;&amp; mant &lt;= 7 );
00252 
00253     *exp_out  = exp;
00254     *mant_out = mant;
00255 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rpe.c::P3" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void RPE_grid_selection P3 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(x, xM, Mc_out)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xM</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Mc_out</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00125 {
00126     <span class="comment">/* register word    temp1;  */</span>
00127     <span class="keyword">register</span> <span class="keywordtype">int</span>        m,  i;
00128     <span class="keyword">register</span> <a class="code" href="private_8h.html#a14">ulongword</a>  utmp;
00129     <span class="keyword">register</span> <a class="code" href="private_8h.html#a12">longword</a>   L_result, L_temp;
00130     <a class="code" href="private_8h.html#a12">longword</a>        EM; <span class="comment">/* xxx should be L_EM? */</span>
00131     <a class="code" href="private_8h.html#a11">word</a>            Mc;
00132 
00133     <a class="code" href="private_8h.html#a12">longword</a>        L_common_0_3;
00134 
00135     EM = 0;
00136     Mc = 0;
00137 
00138     <span class="comment">/* for (m = 0; m &lt;= 3; m++) {</span>
00139 <span class="comment">     *  L_result = 0;</span>
00140 <span class="comment">     *</span>
00141 <span class="comment">     *</span>
00142 <span class="comment">     *  for (i = 0; i &lt;= 12; i++) {</span>
00143 <span class="comment">     *</span>
00144 <span class="comment">     *      temp1    = SASR( x[m + 3*i], 2 );</span>
00145 <span class="comment">     *</span>
00146 <span class="comment">     *      assert(temp1 != MIN_WORD);</span>
00147 <span class="comment">     *</span>
00148 <span class="comment">     *      L_temp   = GSM_L_MULT( temp1, temp1 );</span>
00149 <span class="comment">     *      L_result = GSM_L_ADD( L_temp, L_result );</span>
00150 <span class="comment">     *  }</span>
00151 <span class="comment">     * </span>
00152 <span class="comment">     *  if (L_result &gt; EM) {</span>
00153 <span class="comment">     *      Mc = m;</span>
00154 <span class="comment">     *      EM = L_result;</span>
00155 <span class="comment">     *  }</span>
00156 <span class="comment">     * }</span>
00157 <span class="comment">     */</span>
00158 
00159 <span class="preprocessor">#undef  STEP</span>
00160 <span class="preprocessor"></span><span class="preprocessor">#define STEP( m, i )        L_temp = SASR( x[m + 3 * i], 2 );   \</span>
00161 <span class="preprocessor">                L_result += L_temp * L_temp;</span>
00162 <span class="preprocessor"></span>
00163     <span class="comment">/* common part of 0 and 3 */</span>
00164 
00165     L_result = 0;
00166     STEP( 0, 1 ); STEP( 0, 2 ); STEP( 0, 3 ); STEP( 0, 4 );
00167     STEP( 0, 5 ); STEP( 0, 6 ); STEP( 0, 7 ); STEP( 0, 8 );
00168     STEP( 0, 9 ); STEP( 0, 10); STEP( 0, 11); STEP( 0, 12);
00169     L_common_0_3 = L_result;
00170 
00171     <span class="comment">/* i = 0 */</span>
00172 
00173     STEP( 0, 0 );
00174     L_result &lt;&lt;= 1; <span class="comment">/* implicit in L_MULT */</span>
00175     EM = L_result;
00176 
00177     <span class="comment">/* i = 1 */</span>
00178 
00179     L_result = 0;
00180     STEP( 1, 0 );
00181     STEP( 1, 1 ); STEP( 1, 2 ); STEP( 1, 3 ); STEP( 1, 4 );
00182     STEP( 1, 5 ); STEP( 1, 6 ); STEP( 1, 7 ); STEP( 1, 8 );
00183     STEP( 1, 9 ); STEP( 1, 10); STEP( 1, 11); STEP( 1, 12);
00184     L_result &lt;&lt;= 1;
00185     <span class="keywordflow">if</span> (L_result &gt; EM) {
00186         Mc = 1;
00187         EM = L_result;
00188     }
00189 
00190     <span class="comment">/* i = 2 */</span>
00191 
00192     L_result = 0;
00193     STEP( 2, 0 );
00194     STEP( 2, 1 ); STEP( 2, 2 ); STEP( 2, 3 ); STEP( 2, 4 );
00195     STEP( 2, 5 ); STEP( 2, 6 ); STEP( 2, 7 ); STEP( 2, 8 );
00196     STEP( 2, 9 ); STEP( 2, 10); STEP( 2, 11); STEP( 2, 12);
00197     L_result &lt;&lt;= 1;
00198     <span class="keywordflow">if</span> (L_result &gt; EM) {
00199         Mc = 2;
00200         EM = L_result;
00201     }
00202 
00203     <span class="comment">/* i = 3 */</span>
00204 
00205     L_result = L_common_0_3;
00206     STEP( 3, 12 );
00207     L_result &lt;&lt;= 1;
00208     <span class="keywordflow">if</span> (L_result &gt; EM) {
00209         Mc = 3;
00210         EM = L_result;
00211     }
00212 
00213     
00214 
00215     <span class="comment">/*  Down-sampling by a factor 3 to get the selected xM[0..12]</span>
00216 <span class="comment">     *  RPE sequence.</span>
00217 <span class="comment">     */</span>
00218     <span class="keywordflow">for</span> (i = 0; i &lt;= 12; i ++) xM[i] = x[Mc + 3*i];
00219     *Mc_out = Mc;
00220 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rpe.c::P4" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void APCM_inverse_quantization P4 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(xMc, mant, exp, xMp)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register <a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>mant</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>exp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register <a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00361 {
00362     <span class="keywordtype">int</span> i;
00363     <a class="code" href="private_8h.html#a11">word</a>    temp, temp1, temp2, temp3;
00364     <a class="code" href="private_8h.html#a14">ulongword</a>   utmp;
00365     <a class="code" href="private_8h.html#a12">longword</a>    ltmp;
00366 
00367     assert( mant &gt;= 0 &amp;&amp; mant &lt;= 7 ); 
00368 
00369     temp1 = <a class="code" href="private_8h.html#a24">gsm_FAC</a>[ mant ];    <span class="comment">/* see 4.2-15 for mant */</span>
00370     temp2 = gsm_sub( 6, exp );  <span class="comment">/* see 4.2-15 for exp  */</span>
00371     temp3 = gsm_asl( 1, gsm_sub( temp2, 1 ));
00372 
00373     <span class="keywordflow">for</span> (i = 13; i--;) {
00374 
00375         assert( *xMc &lt;= 7 &amp;&amp; *xMc &gt;= 0 );   <span class="comment">/* 3 bit unsigned */</span>
00376 
00377         <span class="comment">/* temp = gsm_sub( *xMc++ &lt;&lt; 1, 7 ); */</span>
00378         temp = (*xMc++ &lt;&lt; 1) - 7;           <span class="comment">/* restore sign   */</span>
00379         assert( temp &lt;= 7 &amp;&amp; temp &gt;= -7 );  <span class="comment">/* 4 bit signed   */</span>
00380 
00381         temp &lt;&lt;= 12;                <span class="comment">/* 16 bit signed  */</span>
00382         temp = <a class="code" href="private_8h.html#a4">GSM_MULT_R</a>( temp1, temp );
00383         temp = <a class="code" href="private_8h.html#a8">GSM_ADD</a>( temp, temp3 );
00384         *xMp++ = gsm_asr( temp, temp2 );
00385     }
00386 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rpe.c::P5" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void Gsm_RPE_Decoding P5 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(S, xmaxcr, Mcr, xMcr, erp)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structgsm__state.html">gsm_state</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>xmaxcr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMcr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>erp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00483 {
00484     <a class="code" href="private_8h.html#a11">word</a>    exp, mant;
00485     <a class="code" href="private_8h.html#a11">word</a>    xMp[ 13 ];
00486 
00487     APCM_quantization_xmaxc_to_exp_mant( xmaxcr, &amp;exp, &amp;mant );
00488     APCM_inverse_quantization( xMcr, mant, exp, xMp );
00489     RPE_grid_positioning( Mcr, xMp, erp );
00490 
00491 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rpe.c::P5" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void Gsm_RPE_Encoding P5 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(S, e, xmaxc, Mc, xMc)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structgsm__state.html">gsm_state</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>S</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>e</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xmaxc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Mc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00460 {
00461     <a class="code" href="private_8h.html#a11">word</a>    x[40];
00462     <a class="code" href="private_8h.html#a11">word</a>    xM[13], xMp[13];
00463     <a class="code" href="private_8h.html#a11">word</a>    mant, exp;
00464 
00465     Weighting_filter(e, x);
00466     RPE_grid_selection(x, xM, Mc);
00467 
00468     APCM_quantization(  xM, xMc, &amp;mant, &amp;exp, xmaxc);
00469     APCM_inverse_quantization(  xMc,  mant,  exp, xMp);
00470 
00471     RPE_grid_positioning( *Mc, xMp, e );
00472 
00473 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rpe.c::P5" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void APCM_quantization P5 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">(xM, xMc, mant_out, exp_out, xmaxc_out)&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xM</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xMc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mant_out</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>exp_out</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="private_8h.html#a11">word</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>xmaxc_out</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00265 {
00266     <span class="keywordtype">int</span> i, itest;
00267 
00268     <span class="keyword">register</span> <a class="code" href="private_8h.html#a12">longword</a>   ltmp;   <span class="comment">/* for GSM_ADD */</span>
00269     <a class="code" href="private_8h.html#a11">word</a>    xmax, xmaxc, temp, temp1, temp2;
00270     <a class="code" href="private_8h.html#a11">word</a>    exp, mant;
00271 
00272 
00273     <span class="comment">/*  Find the maximum absolute value xmax of xM[0..12].</span>
00274 <span class="comment">     */</span>
00275 
00276     xmax = 0;
00277     <span class="keywordflow">for</span> (i = 0; i &lt;= 12; i++) {
00278         temp = xM[i];
00279         temp = <a class="code" href="private_8h.html#a10">GSM_ABS</a>(temp);
00280         <span class="keywordflow">if</span> (temp &gt; xmax) xmax = temp;
00281     }
00282 
00283     <span class="comment">/*  Qantizing and coding of xmax to get xmaxc.</span>
00284 <span class="comment">     */</span>
00285 
00286     exp   = 0;
00287     temp  = SASR( xmax, 9 );
00288     itest = 0;
00289 
00290     <span class="keywordflow">for</span> (i = 0; i &lt;= 5; i++) {
00291 
00292         itest |= (temp &lt;= 0);
00293         temp = SASR( temp, 1 );
00294 
00295         assert(exp &lt;= 5);
00296         <span class="keywordflow">if</span> (itest == 0) exp++;      <span class="comment">/* exp = add (exp, 1) */</span>
00297     }
00298 
00299     assert(exp &lt;= 6 &amp;&amp; exp &gt;= 0);
00300     temp = exp + 5;
00301 
00302     assert(temp &lt;= 11 &amp;&amp; temp &gt;= 0);
00303     xmaxc = gsm_add( SASR(xmax, temp), exp &lt;&lt; 3 );
00304 
00305     <span class="comment">/*   Quantizing and coding of the xM[0..12] RPE sequence</span>
00306 <span class="comment">     *   to get the xMc[0..12]</span>
00307 <span class="comment">     */</span>
00308 
00309     APCM_quantization_xmaxc_to_exp_mant( xmaxc, &amp;exp, &amp;mant );
00310 
00311     <span class="comment">/*  This computation uses the fact that the decoded version of xmaxc</span>
00312 <span class="comment">     *  can be calculated by using the exponent and the mantissa part of</span>
00313 <span class="comment">     *  xmaxc (logarithmic table).</span>
00314 <span class="comment">     *  So, this method avoids any division and uses only a scaling</span>
00315 <span class="comment">     *  of the RPE samples by a function of the exponent.  A direct </span>
00316 <span class="comment">     *  multiplication by the inverse of the mantissa (NRFAC[0..7]</span>
00317 <span class="comment">     *  found in table 4.5) gives the 3 bit coded version xMc[0..12]</span>
00318 <span class="comment">     *  of the RPE samples.</span>
00319 <span class="comment">     */</span>
00320 
00321 
00322     <span class="comment">/* Direct computation of xMc[0..12] using table 4.5</span>
00323 <span class="comment">     */</span>
00324 
00325     assert( exp &lt;= 4096 &amp;&amp; exp &gt;= -4096);
00326     assert( mant &gt;= 0 &amp;&amp; mant &lt;= 7 ); 
00327 
00328     temp1 = 6 - exp;        <span class="comment">/* normalization by the exponent */</span>
00329     temp2 = <a class="code" href="private_8h.html#a23">gsm_NRFAC</a>[ mant ];      <span class="comment">/* inverse mantissa          */</span>
00330 
00331     <span class="keywordflow">for</span> (i = 0; i &lt;= 12; i++) {
00332 
00333         assert(temp1 &gt;= 0 &amp;&amp; temp1 &lt; 16);
00334 
00335         temp = xM[i] &lt;&lt; temp1;
00336         temp = <a class="code" href="private_8h.html#a5">GSM_MULT</a>( temp, temp2 );
00337         temp = SASR(temp, 12);
00338         xMc[i] = temp + 4;      <span class="comment">/* see note below */</span>
00339     }
00340 
00341     <span class="comment">/*  NOTE: This equation is used to make all the xMc[i] positive.</span>
00342 <span class="comment">     */</span>
00343 
00344     *mant_out  = mant;
00345     *exp_out   = exp;
00346     *xmaxc_out = xmaxc;
00347 }
</pre></div>    </td>
  </tr>
</table>
<hr><address><small>
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53></a>
<br>
FTPhone : Mon Jan 5 01:56:27 2004.

<!--
Generated at Mon Jan 5 01:56:27 2004 for FTPhone by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.4 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
-->
</body>
</html>
