<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//PL">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-2">
<title>ftplib.c File Reference</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#fffeff">
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>ftplib.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include "<a class="el" href="ftplib_8h-source.html">ftplib.h</a>"</code><br>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structNetBuf.html">NetBuf</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a0">BUILDING_LIBRARY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a1">SETSOCKOPT_OPTVAL_TYPE</a>&nbsp;&nbsp;&nbsp;(void *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>&nbsp;&nbsp;&nbsp;8192</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a3">ACCEPT_TIMEOUT</a>&nbsp;&nbsp;&nbsp;30</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a5">FTPLIB_READ</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a7">FTPLIB_DEFMODE</a>&nbsp;&nbsp;&nbsp;FTPLIB_PASSIVE</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a10">socket_wait</a> (<a class="el" href="structNetBuf.html">netbuf</a> *ctl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a11">readline</a> (char *buf, int max, <a class="el" href="structNetBuf.html">netbuf</a> *ctl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a12">writeline</a> (char *buf, int len, <a class="el" href="structNetBuf.html">netbuf</a> *nData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a13">readresp</a> (char c, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a14">FtpInit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF char *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a15">FtpLastResponse</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a16">FtpConnect</a> (const  char *host, <a class="el" href="structNetBuf.html">netbuf</a> **nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a17">FtpOptions</a> (int opt, long val, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a18">FtpSendCmd</a> (const  char *cmd, char expresp, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a19">FtpLogin</a> (const  char *user, const  char *pass, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a20">FtpOpenPort</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nControl, <a class="el" href="structNetBuf.html">netbuf</a> **nData, int mode, int dir)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a21">FtpAcceptConnection</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nData, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a22">FtpAccess</a> (const  char *path, int typ, int mode, <a class="el" href="structNetBuf.html">netbuf</a> *nControl, <a class="el" href="structNetBuf.html">netbuf</a> **nData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a23">FtpRead</a> (void *buf, int max, <a class="el" href="structNetBuf.html">netbuf</a> *nData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a24">FtpWrite</a> (void *buf, int len, <a class="el" href="structNetBuf.html">netbuf</a> *nData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a25">FtpClose</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a26">FtpSite</a> (const  char *cmd, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a27">FtpSysType</a> (char *buf, int max, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a28">FtpMkdir</a> (const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a29">FtpChdir</a> (const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a30">FtpCDUp</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a31">FtpRmdir</a> (const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a32">FtpPwd</a> (char *path, int max, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a33">FtpXfer</a> (const  char *localfile, const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl, int typ, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a34">FtpNlst</a> (const  char *outputfile, const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a35">FtpDir</a> (const  char *outputfile, const  char *path, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a36">FtpSize</a> (const  char *path, int *size, char mode, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a37">FtpModDate</a> (const  char *path, char *dt, int max, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a38">FtpGet</a> (const  char *outputfile, const  char *path, char mode, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a39">FtpPut</a> (const  char *inputfile, const  char *path, char mode, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a40">FtpRename</a> (const  char *src, const  char *dst, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a41">FtpDelete</a> (const  char *fnm, <a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a42">FtpQuit</a> (<a class="el" href="structNetBuf.html">netbuf</a> *nControl)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>char *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a8">version</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GLOBALDEF int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ftplib_8c.html#a9">ftplib_debug</a> = 0</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3" doxytag="ftplib.c::ACCEPT_TIMEOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ACCEPT_TIMEOUT&nbsp;&nbsp;&nbsp;30
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ftplib.c::BUILDING_LIBRARY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BUILDING_LIBRARY
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ftplib.c::FTPLIB_BUFSIZ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FTPLIB_BUFSIZ&nbsp;&nbsp;&nbsp;8192
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ftplib.c::FTPLIB_CONTROL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FTPLIB_CONTROL&nbsp;&nbsp;&nbsp;0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ftplib.c::FTPLIB_DEFMODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FTPLIB_DEFMODE&nbsp;&nbsp;&nbsp;FTPLIB_PASSIVE
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ftplib.c::FTPLIB_READ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FTPLIB_READ&nbsp;&nbsp;&nbsp;1
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ftplib.c::FTPLIB_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FTPLIB_WRITE&nbsp;&nbsp;&nbsp;2
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ftplib.c::SETSOCKOPT_OPTVAL_TYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SETSOCKOPT_OPTVAL_TYPE&nbsp;&nbsp;&nbsp;(void *)
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="ftplib.c::FtpAcceptConnection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FtpAcceptConnection </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00729 {
00730   <span class="keywordtype">int</span> sData;
00731   <span class="keyword">struct </span>sockaddr addr;
00732   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l;
00733   <span class="keywordtype">int</span> i;
00734   <span class="keyword">struct </span>timeval tv;
00735   fd_set mask;
00736   <span class="keywordtype">int</span> rv;
00737 
00738   FD_ZERO(&amp;mask);
00739   FD_SET(nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;mask);
00740   FD_SET(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;mask);
00741   tv.tv_usec = 0;
00742   tv.tv_sec = <a class="code" href="ftplib_8c.html#a3">ACCEPT_TIMEOUT</a>;
00743   i = nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>;
00744   <span class="keywordflow">if</span> (i &lt; nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>)
00745     i = nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>;
00746   i = select(i+1, &amp;mask, NULL, NULL, &amp;tv);
00747   <span class="keywordflow">if</span> (i == -1)
00748     {
00749       strncpy(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, strerror(errno),
00750           <span class="keyword">sizeof</span>(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>));
00751       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00752       nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = 0;
00753       rv = 0;
00754     }
00755   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 0)
00756     {
00757       strcpy(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="stringliteral">"timed out waiting for connection"</span>);
00758       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00759       nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = 0;
00760       rv = 0;
00761     }
00762   <span class="keywordflow">else</span>
00763     {
00764       <span class="keywordflow">if</span> (FD_ISSET(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;mask))
00765     {
00766       l = <span class="keyword">sizeof</span>(addr);
00767       sData = accept(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;addr, &amp;l);
00768       i = <a class="code" href="Debug_8hxx.html#a2">errno</a>;
00769       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00770       <span class="keywordflow">if</span> (sData &gt; 0)
00771         {
00772           rv = 1;
00773           nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = sData;
00774         }
00775       <span class="keywordflow">else</span>
00776         {
00777           strncpy(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, strerror(i),
00778               <span class="keyword">sizeof</span>(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>));
00779           nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = 0;
00780           rv = 0;
00781         }
00782     }
00783       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FD_ISSET(nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;mask))
00784     {
00785       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00786       nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = 0;
00787       <a class="code" href="ftplib_8c.html#a13">readresp</a>(<span class="charliteral">'2'</span>, nControl);
00788       rv = 0;
00789     }
00790     }
00791   <span class="keywordflow">return</span> rv;    
00792 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ftplib.c::FtpAccess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpAccess </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>typ</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00801 {
00802   <span class="keywordtype">char</span> buf[256];
00803   <span class="keywordtype">int</span> dir;
00804   <span class="keywordflow">if</span> ((path == NULL) &amp;&amp;
00805       ((typ == <a class="code" href="ftplib_8h.html#a4">FTPLIB_FILE_WRITE</a>) || (typ == <a class="code" href="ftplib_8h.html#a3">FTPLIB_FILE_READ</a>)))
00806     {
00807       sprintf(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,
00808           <span class="stringliteral">"Missing path argument for file transfer\n"</span>);
00809       <span class="keywordflow">return</span> 0;
00810     }
00811   sprintf(buf, <span class="stringliteral">"TYPE %c"</span>, mode);
00812   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf, <span class="charliteral">'2'</span>, nControl))
00813     <span class="keywordflow">return</span> 0;
00814   <span class="keywordflow">switch</span> (typ)
00815     {
00816     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a1">FTPLIB_DIR</a>:
00817       strcpy(buf,<span class="stringliteral">"NLST"</span>);
00818       dir = <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>;
00819       <span class="keywordflow">break</span>;
00820     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a2">FTPLIB_DIR_VERBOSE</a>:
00821       strcpy(buf,<span class="stringliteral">"LIST"</span>);
00822       dir = <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>;
00823       <span class="keywordflow">break</span>;
00824     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a3">FTPLIB_FILE_READ</a>:
00825       strcpy(buf,<span class="stringliteral">"RETR"</span>);
00826       dir = <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>;
00827       <span class="keywordflow">break</span>;
00828     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a4">FTPLIB_FILE_WRITE</a>:
00829       strcpy(buf,<span class="stringliteral">"STOR"</span>);
00830       dir = <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>;
00831       <span class="keywordflow">break</span>;
00832     <span class="keywordflow">default</span>:
00833       sprintf(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="stringliteral">"Invalid open type %d\n"</span>, typ);
00834       <span class="keywordflow">return</span> 0;
00835     }
00836   <span class="keywordflow">if</span> (path != NULL)
00837     {
00838       <span class="keywordtype">int</span> i = strlen(buf);
00839       buf[i++] = <span class="charliteral">' '</span>;
00840       <span class="keywordflow">if</span> ((strlen(path) + i) &gt;= <span class="keyword">sizeof</span>(buf))
00841     <span class="keywordflow">return</span> 0;
00842       strcpy(&amp;buf[i],path);
00843     }
00844   <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a20">FtpOpenPort</a>(nControl, nData, mode, dir) == -1)
00845     <span class="keywordflow">return</span> 0;
00846   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf, <span class="charliteral">'1'</span>, nControl))
00847     {
00848       <a class="code" href="ftplib_8c.html#a25">FtpClose</a>(*nData);
00849       *nData = NULL;
00850       <span class="keywordflow">return</span> 0;
00851     }
00852   (*nData)-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a> = nControl;
00853   nControl-&gt;<a class="code" href="structNetBuf.html#o8">data</a> = *nData;
00854   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o9">cmode</a> == <a class="code" href="ftplib_8h.html#a10">FTPLIB_PORT</a>)
00855     {
00856       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a21">FtpAcceptConnection</a>(*nData,nControl))
00857     {
00858       <a class="code" href="ftplib_8c.html#a25">FtpClose</a>(*nData);
00859       *nData = NULL;
00860       nControl-&gt;<a class="code" href="structNetBuf.html#o8">data</a> = NULL;
00861       <span class="keywordflow">return</span> 0;
00862     }
00863     }
00864   <span class="keywordflow">return</span> 1;
00865 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="ftplib.c::FtpCDUp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpCDUp </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nControl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01048 {
01049   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(<span class="stringliteral">"CDUP"</span>,<span class="charliteral">'2'</span>,nControl))
01050     <span class="keywordflow">return</span> 0;
01051   <span class="keywordflow">return</span> 1;
01052 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="ftplib.c::FtpChdir" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpChdir </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01031 {
01032   <span class="keywordtype">char</span> buf[256];
01033 
01034   <span class="keywordflow">if</span> ((strlen(path) + 6) &gt; <span class="keyword">sizeof</span>(buf))
01035     <span class="keywordflow">return</span> 0;
01036   sprintf(buf,<span class="stringliteral">"CWD %s"</span>,path);
01037   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>,nControl))
01038     <span class="keywordflow">return</span> 0;
01039   <span class="keywordflow">return</span> 1;
01040 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ftplib.c::FtpClose" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpClose </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00934 {
00935   <a class="code" href="structNetBuf.html">netbuf</a> *ctrl;
00936   <span class="keywordflow">switch</span> (nData-&gt;<a class="code" href="structNetBuf.html#o6">dir</a>)
00937     {
00938     <span class="keywordflow">case</span> <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>:
00939       <span class="comment">/* potential problem - if buffer flush fails, how to notify user? */</span>
00940       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a> != NULL)
00941     <a class="code" href="ftplib_8c.html#a12">writeline</a>(NULL, 0, nData);
00942     <span class="keywordflow">case</span> <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>:
00943       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>)
00944     free(nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>);
00945       shutdown(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>,2);
00946       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00947       ctrl = nData-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a>;
00948       free(nData);
00949       <span class="keywordflow">if</span> (ctrl)
00950     {
00951       ctrl-&gt;<a class="code" href="structNetBuf.html#o8">data</a> = NULL;
00952       <span class="keywordflow">return</span>(<a class="code" href="ftplib_8c.html#a13">readresp</a>(<span class="charliteral">'2'</span>, ctrl));
00953     }
00954       <span class="keywordflow">return</span> 1;
00955     <span class="keywordflow">case</span> <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>:
00956       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o8">data</a>)
00957     {
00958       nData-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a> = NULL;
00959       <a class="code" href="ftplib_8c.html#a25">FtpClose</a>(nData);
00960     }
00961       net_close(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
00962       free(nData);
00963       <span class="keywordflow">return</span> 0;
00964     }
00965   <span class="keywordflow">return</span> 1;
00966 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ftplib.c::FtpConnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpConnect </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>host</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00387 {
00388   <span class="keywordtype">int</span> sControl;
00389   <span class="keyword">struct </span>sockaddr_in sin;
00390   <span class="keyword">struct </span>hostent *phe;
00391   <span class="keyword">struct </span>servent *pse;
00392   <span class="keywordtype">int</span> on=1;
00393   <a class="code" href="structNetBuf.html">netbuf</a> *ctrl;
00394   <span class="keywordtype">char</span> *lhost;
00395   <span class="keywordtype">char</span> *pnum;
00396 
00397   memset(&amp;sin,0,<span class="keyword">sizeof</span>(sin));
00398   sin.sin_family = AF_INET;
00399   lhost = strdup(host);
00400   pnum = strchr(lhost,<span class="charliteral">':'</span>);
00401   <span class="keywordflow">if</span> (pnum == NULL)
00402     {
00403 <span class="preprocessor">#if defined(VMS)</span>
00404 <span class="preprocessor"></span>      sin.sin_port = htons(21);
00405 <span class="preprocessor">#else</span>
00406 <span class="preprocessor"></span>      <span class="keywordflow">if</span> ((pse = getservbyname(<span class="stringliteral">"ftp"</span>,<span class="stringliteral">"tcp"</span>)) == NULL)
00407         {
00408       perror(<span class="stringliteral">"getservbyname"</span>);
00409       <span class="keywordflow">return</span> 0;
00410         }
00411       sin.sin_port = pse-&gt;s_port;
00412 <span class="preprocessor">#endif</span>
00413 <span class="preprocessor"></span>    }
00414   <span class="keywordflow">else</span>
00415     {
00416       *pnum++ = <span class="charliteral">'\0'</span>;
00417       <span class="keywordflow">if</span> (isdigit(*pnum))
00418     sin.sin_port = htons(atoi(pnum));
00419       <span class="keywordflow">else</span>
00420     {
00421       pse = getservbyname(pnum,<span class="stringliteral">"tcp"</span>);
00422       sin.sin_port = pse-&gt;s_port;
00423     }
00424     }
00425   <span class="keywordflow">if</span> ((sin.sin_addr.s_addr = inet_addr(lhost)) == -1)
00426     {
00427       <span class="keywordflow">if</span> ((phe = gethostbyname(lhost)) == NULL)
00428         {
00429       perror(<span class="stringliteral">"gethostbyname"</span>);
00430       <span class="keywordflow">return</span> 0;
00431         }
00432       memcpy((<span class="keywordtype">char</span> *)&amp;sin.sin_addr, phe-&gt;h_addr, phe-&gt;h_length);
00433     }
00434   free(lhost);
00435   sControl = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);
00436   <span class="keywordflow">if</span> (sControl == -1)
00437     {
00438       perror(<span class="stringliteral">"socket"</span>);
00439       <span class="keywordflow">return</span> 0;
00440     }
00441   <span class="keywordflow">if</span> (setsockopt(sControl,SOL_SOCKET,SO_REUSEADDR,
00442          SETSOCKOPT_OPTVAL_TYPE &amp;on, <span class="keyword">sizeof</span>(on)) == -1)
00443     {
00444       perror(<span class="stringliteral">"setsockopt"</span>);
00445       net_close(sControl);
00446       <span class="keywordflow">return</span> 0;
00447     }
00448   <span class="keywordflow">if</span> (connect(sControl, (<span class="keyword">struct</span> sockaddr *)&amp;sin, <span class="keyword">sizeof</span>(sin)) == -1)
00449     {
00450       perror(<span class="stringliteral">"connect"</span>);
00451       net_close(sControl);
00452       <span class="keywordflow">return</span> 0;
00453     }
00454   ctrl = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structNetBuf.html">netbuf</a>));
00455   <span class="keywordflow">if</span> (ctrl == NULL)
00456     {
00457       perror(<span class="stringliteral">"calloc"</span>);
00458       net_close(sControl);
00459       <span class="keywordflow">return</span> 0;
00460     }
00461   ctrl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a> = malloc(FTPLIB_BUFSIZ);
00462   <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a> == NULL)
00463     {
00464       perror(<span class="stringliteral">"calloc"</span>);
00465       net_close(sControl);
00466       free(ctrl);
00467       <span class="keywordflow">return</span> 0;
00468     }
00469   ctrl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = sControl;
00470   ctrl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> = <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>;
00471   ctrl-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a> = NULL;
00472   ctrl-&gt;<a class="code" href="structNetBuf.html#o9">cmode</a> = <a class="code" href="ftplib_8c.html#a7">FTPLIB_DEFMODE</a>;
00473   ctrl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> = NULL;
00474   ctrl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_sec = ctrl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_usec = 0;
00475   ctrl-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a> = NULL;
00476   ctrl-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a> = 0;
00477   ctrl-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> = 0;
00478   ctrl-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a> = 0;
00479   <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a13">readresp</a>(<span class="charliteral">'2'</span>, ctrl) == 0)
00480     {
00481       net_close(sControl);
00482       free(ctrl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>);
00483       free(ctrl);
00484       <span class="keywordflow">return</span> 0;
00485     }
00486   *nControl = ctrl;
00487   <span class="keywordflow">return</span> 1;
00488 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="ftplib.c::FtpDelete" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpDelete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fnm</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01273 {
01274   <span class="keywordtype">char</span> cmd[256];
01275 
01276   <span class="keywordflow">if</span> ((strlen(fnm) + 7) &gt; <span class="keyword">sizeof</span>(cmd))
01277     <span class="keywordflow">return</span> 0;
01278   sprintf(cmd,<span class="stringliteral">"DELE %s"</span>,fnm);
01279   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(cmd,<span class="charliteral">'2'</span>, nControl))
01280     <span class="keywordflow">return</span> 0;
01281   <span class="keywordflow">return</span> 1;
01282 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="ftplib.c::FtpDir" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpDir </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>outputfile</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01172 {
01173   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a33">FtpXfer</a>(outputfile, path, nControl, FTPLIB_DIR_VERBOSE, FTPLIB_ASCII);
01174 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="ftplib.c::FtpGet" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpGet </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>outputfile</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01231 {
01232   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a33">FtpXfer</a>(outputfile, path, nControl, FTPLIB_FILE_READ, mode);
01233 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ftplib.c::FtpInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF void FtpInit </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00358 {
00359 <span class="preprocessor">#if defined(_WIN32)</span>
00360 <span class="preprocessor"></span>  <a class="code" href="wave_8h.html#a3">WORD</a> wVersionRequested;
00361   WSADATA wsadata;
00362   <span class="keywordtype">int</span> err;
00363   wVersionRequested = MAKEWORD(1,1);
00364   <span class="keywordflow">if</span> ((err = WSAStartup(wVersionRequested,&amp;wsadata)) != 0)
00365     fprintf(stderr,<span class="stringliteral">"Network failed to start: %d\n"</span>,err);
00366   <span class="keywordflow">else</span>
00367     fprintf(stdout, <span class="stringliteral">"%s\n"</span>, version);
00368 <span class="preprocessor">#endif</span>
00369 <span class="preprocessor"></span>}
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ftplib.c::FtpLastResponse" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF char* FtpLastResponse </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nControl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00375 {
00376   <span class="keywordflow">if</span> ((nControl) &amp;&amp; (nControl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> == <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>))
00377     <span class="keywordflow">return</span> nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>;
00378   <span class="keywordflow">return</span> NULL;
00379 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ftplib.c::FtpLogin" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpLogin </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>user</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>pass</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00559 {
00560   <span class="keywordtype">char</span> tempbuf[64];
00561 
00562   <span class="keywordflow">if</span> (((strlen(user) + 7) &gt; <span class="keyword">sizeof</span>(tempbuf)) ||
00563       ((strlen(pass) + 7) &gt; <span class="keyword">sizeof</span>(tempbuf)))
00564     <span class="keywordflow">return</span> 0;
00565   sprintf(tempbuf,<span class="stringliteral">"USER %s"</span>,user);
00566   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(tempbuf,<span class="charliteral">'3'</span>,nControl))
00567     {
00568       <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>[0] == <span class="charliteral">'2'</span>)
00569     <span class="keywordflow">return</span> 1;
00570       <span class="keywordflow">return</span> 0;
00571     }
00572   sprintf(tempbuf,<span class="stringliteral">"PASS %s"</span>,pass);
00573   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(tempbuf,<span class="charliteral">'2'</span>,nControl);
00574 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="ftplib.c::FtpMkdir" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpMkdir </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01014 {
01015   <span class="keywordtype">char</span> buf[256];
01016 
01017   <span class="keywordflow">if</span> ((strlen(path) + 6) &gt; <span class="keyword">sizeof</span>(buf))
01018     <span class="keywordflow">return</span> 0;
01019   sprintf(buf,<span class="stringliteral">"MKD %s"</span>,path);
01020   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>, nControl))
01021     <span class="keywordflow">return</span> 0;
01022   <span class="keywordflow">return</span> 1;
01023 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="ftplib.c::FtpModDate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpModDate </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dt</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01210 {
01211   <span class="keywordtype">char</span> buf[256];
01212   <span class="keywordtype">int</span> rv = 1;
01213 
01214   <span class="keywordflow">if</span> ((strlen(path) + 7) &gt; <span class="keyword">sizeof</span>(buf))
01215     <span class="keywordflow">return</span> 0;
01216   sprintf(buf,<span class="stringliteral">"MDTM %s"</span>,path);
01217   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>,nControl))
01218     rv = 0;
01219   <span class="keywordflow">else</span>
01220     strncpy(dt, &amp;nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>[4], max);
01221   <span class="keywordflow">return</span> rv;
01222 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="ftplib.c::FtpNlst" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpNlst </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>outputfile</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01162 {
01163   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a33">FtpXfer</a>(outputfile, path, nControl, FTPLIB_DIR, FTPLIB_ASCII);
01164 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ftplib.c::FtpOpenPort" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FtpOpenPort </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dir</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00582 {
00583   <span class="keywordtype">int</span> sData;
00584   <span class="keyword">union </span>{
00585     <span class="keyword">struct </span>sockaddr sa;
00586     <span class="keyword">struct </span>sockaddr_in <a class="code" href="toast_8c.html#a9">in</a>;
00587   } sin;
00588   <span class="keyword">struct </span>linger lng = { 0, 0 };
00589   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l;
00590   <span class="keywordtype">int</span> on=1;
00591   <a class="code" href="structNetBuf.html">netbuf</a> *ctrl;
00592   <span class="keywordtype">char</span> *cp;
00593   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v[6];
00594   <span class="keywordtype">char</span> buf[256];
00595 
00596   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>)
00597     <span class="keywordflow">return</span> -1;
00598   <span class="keywordflow">if</span> ((dir != <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>) &amp;&amp; (dir != <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>))
00599     {
00600       sprintf(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="stringliteral">"Invalid direction %d\n"</span>, dir);
00601       <span class="keywordflow">return</span> -1;
00602     }
00603   <span class="keywordflow">if</span> ((mode != <a class="code" href="ftplib_8h.html#a5">FTPLIB_ASCII</a>) &amp;&amp; (mode != <a class="code" href="ftplib_8h.html#a6">FTPLIB_IMAGE</a>))
00604     {
00605       sprintf(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="stringliteral">"Invalid mode %c\n"</span>, mode);
00606       <span class="keywordflow">return</span> -1;
00607     }
00608   l = <span class="keyword">sizeof</span>(sin);
00609   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o9">cmode</a> == <a class="code" href="ftplib_8h.html#a9">FTPLIB_PASSIVE</a>)
00610     {
00611       memset(&amp;sin, 0, l);
00612       sin.in.sin_family = AF_INET;
00613       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(<span class="stringliteral">"PASV"</span>,<span class="charliteral">'2'</span>,nControl))
00614     <span class="keywordflow">return</span> -1;
00615       cp = strchr(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,<span class="charliteral">'('</span>);
00616       <span class="keywordflow">if</span> (cp == NULL)
00617     <span class="keywordflow">return</span> -1;
00618       cp++;
00619       sscanf(cp,<span class="stringliteral">"%u,%u,%u,%u,%u,%u"</span>,&amp;v[2],&amp;v[3],&amp;v[4],&amp;v[5],&amp;v[0],&amp;v[1]);
00620       sin.sa.sa_data[2] = v[2];
00621       sin.sa.sa_data[3] = v[3];
00622       sin.sa.sa_data[4] = v[4];
00623       sin.sa.sa_data[5] = v[5];
00624       sin.sa.sa_data[0] = v[0];
00625       sin.sa.sa_data[1] = v[1];
00626     }
00627   <span class="keywordflow">else</span>
00628     {
00629       <span class="keywordflow">if</span> (getsockname(nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, &amp;sin.sa, &amp;l) &lt; 0)
00630     {
00631       perror(<span class="stringliteral">"getsockname"</span>);
00632       <span class="keywordflow">return</span> 0;
00633     }
00634     }
00635   sData = socket(PF_INET,SOCK_STREAM,IPPROTO_TCP);
00636   <span class="keywordflow">if</span> (sData == -1)
00637     {
00638       perror(<span class="stringliteral">"socket"</span>);
00639       <span class="keywordflow">return</span> -1;
00640     }
00641   <span class="keywordflow">if</span> (setsockopt(sData,SOL_SOCKET,SO_REUSEADDR,
00642          SETSOCKOPT_OPTVAL_TYPE &amp;on,<span class="keyword">sizeof</span>(on)) == -1)
00643     {
00644       perror(<span class="stringliteral">"setsockopt"</span>);
00645       net_close(sData);
00646       <span class="keywordflow">return</span> -1;
00647     }
00648   <span class="keywordflow">if</span> (setsockopt(sData,SOL_SOCKET,SO_LINGER,
00649          SETSOCKOPT_OPTVAL_TYPE &amp;lng,<span class="keyword">sizeof</span>(lng)) == -1)
00650     {
00651       perror(<span class="stringliteral">"setsockopt"</span>);
00652       net_close(sData);
00653       <span class="keywordflow">return</span> -1;
00654     }
00655   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o9">cmode</a> == <a class="code" href="ftplib_8h.html#a9">FTPLIB_PASSIVE</a>)
00656     {
00657       <span class="keywordflow">if</span> (connect(sData, &amp;sin.sa, <span class="keyword">sizeof</span>(sin.sa)) == -1)
00658     {
00659       perror(<span class="stringliteral">"connect"</span>);
00660       net_close(sData);
00661       <span class="keywordflow">return</span> -1;
00662     }
00663     }
00664   <span class="keywordflow">else</span>
00665     {
00666       sin.in.sin_port = 0;
00667       <span class="keywordflow">if</span> (bind(sData, &amp;sin.sa, <span class="keyword">sizeof</span>(sin)) == -1)
00668     {
00669       perror(<span class="stringliteral">"bind"</span>);
00670       net_close(sData);
00671       <span class="keywordflow">return</span> 0;
00672     }
00673       <span class="keywordflow">if</span> (listen(sData, 1) &lt; 0)
00674     {
00675       perror(<span class="stringliteral">"listen"</span>);
00676       net_close(sData);
00677       <span class="keywordflow">return</span> 0;
00678     }
00679       <span class="keywordflow">if</span> (getsockname(sData, &amp;sin.sa, &amp;l) &lt; 0)
00680     <span class="keywordflow">return</span> 0;
00681       sprintf(buf, <span class="stringliteral">"PORT %d,%d,%d,%d,%d,%d"</span>,
00682           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[2],
00683           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[3],
00684           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[4],
00685           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[5],
00686           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[0],
00687           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) sin.sa.sa_data[1]);
00688       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>,nControl))
00689     {
00690       net_close(sData);
00691       <span class="keywordflow">return</span> 0;
00692     }
00693     }
00694   ctrl = calloc(1,<span class="keyword">sizeof</span>(<a class="code" href="structNetBuf.html">netbuf</a>));
00695   <span class="keywordflow">if</span> (ctrl == NULL)
00696     {
00697       perror(<span class="stringliteral">"calloc"</span>);
00698       net_close(sData);
00699       <span class="keywordflow">return</span> -1;
00700     }
00701   <span class="keywordflow">if</span> ((mode == <span class="charliteral">'A'</span>) &amp;&amp; ((ctrl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a> = malloc(FTPLIB_BUFSIZ)) == NULL))
00702     {
00703       perror(<span class="stringliteral">"calloc"</span>);
00704       net_close(sData);
00705       free(ctrl);
00706       <span class="keywordflow">return</span> -1;
00707     }
00708   ctrl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a> = sData;
00709   ctrl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> = dir;
00710   ctrl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a> = nControl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>;
00711   ctrl-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a> = nControl-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a>;
00712   ctrl-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a> = 0;
00713   ctrl-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> = 0;
00714   ctrl-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a> = nControl-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>;
00715   <span class="keywordflow">if</span> (ctrl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_sec || ctrl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_usec || ctrl-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>)
00716     ctrl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> = nControl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a>;
00717   <span class="keywordflow">else</span>
00718     ctrl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> = NULL;
00719   *nData = ctrl;
00720   <span class="keywordflow">return</span> 1;
00721 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ftplib.c::FtpOptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpOptions </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>opt</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>val</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00496 {
00497   <span class="keywordtype">int</span> v,rv=0;
00498   <span class="keywordflow">switch</span> (opt)
00499     {
00500     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a11">FTPLIB_CONNMODE</a>:
00501       v = (<span class="keywordtype">int</span>) val;
00502       <span class="keywordflow">if</span> ((v == <a class="code" href="ftplib_8h.html#a9">FTPLIB_PASSIVE</a>) || (v == <a class="code" href="ftplib_8h.html#a10">FTPLIB_PORT</a>))
00503     {
00504       nControl-&gt;<a class="code" href="structNetBuf.html#o9">cmode</a> = v;
00505       rv = 1;
00506     }
00507       <span class="keywordflow">break</span>;
00508     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a12">FTPLIB_CALLBACK</a>:
00509       nControl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> = (<a class="code" href="ftplib_8h.html#a17">FtpCallback</a>) val;
00510       rv = 1;
00511       <span class="keywordflow">break</span>;
00512     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a13">FTPLIB_IDLETIME</a>:
00513       v = (<span class="keywordtype">int</span>) val;
00514       rv = 1;
00515       nControl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_sec = v / 1000;
00516       nControl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>.tv_usec = (v % 1000) * 1000;
00517       <span class="keywordflow">break</span>;
00518     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a14">FTPLIB_CALLBACKARG</a>:
00519       rv = 1;
00520       nControl-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a> = (<span class="keywordtype">void</span> *) val;
00521       <span class="keywordflow">break</span>;
00522     <span class="keywordflow">case</span> <a class="code" href="ftplib_8h.html#a15">FTPLIB_CALLBACKBYTES</a>:
00523       rv = 1;
00524       nControl-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a> = (<span class="keywordtype">int</span>) val;
00525       <span class="keywordflow">break</span>;
00526     }
00527   <span class="keywordflow">return</span> rv;
00528 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="ftplib.c::FtpPut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpPut </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>inputfile</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01242 {
01243   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a33">FtpXfer</a>(inputfile, path, nControl, FTPLIB_FILE_WRITE, mode);
01244 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="ftplib.c::FtpPwd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpPwd </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01077 {
01078   <span class="keywordtype">int</span> l = max;
01079   <span class="keywordtype">char</span> *b = path;
01080   <span class="keywordtype">char</span> *s;
01081   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(<span class="stringliteral">"PWD"</span>,<span class="charliteral">'2'</span>,nControl))
01082     <span class="keywordflow">return</span> 0;
01083   s = strchr(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="charliteral">'"'</span>);
01084   <span class="keywordflow">if</span> (s == NULL)
01085     <span class="keywordflow">return</span> 0;
01086   s++;
01087   <span class="keywordflow">while</span> ((--l) &amp;&amp; (*s) &amp;&amp; (*s != <span class="charliteral">'"'</span>))
01088     *b++ = *s++;
01089   *b++ = <span class="charliteral">'\0'</span>;
01090   <span class="keywordflow">return</span> 1;
01091 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="ftplib.c::FtpQuit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF void FtpQuit </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>nControl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01290 {
01291   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>)
01292     <span class="keywordflow">return</span>;
01293   <a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(<span class="stringliteral">"QUIT"</span>,<span class="charliteral">'2'</span>,nControl);
01294   net_close(nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>);
01295   free(nControl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>);
01296   free(nControl);
01297 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ftplib.c::FtpRead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpRead </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00871 {
00872   <span class="keywordtype">int</span> i;
00873   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>)
00874     <span class="keywordflow">return</span> 0;
00875   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>)
00876     i = <a class="code" href="ftplib_8c.html#a11">readline</a>(buf, max, nData);
00877   <span class="keywordflow">else</span>
00878     {
00879       i = <a class="code" href="ftplib_8c.html#a10">socket_wait</a>(nData);
00880       <span class="keywordflow">if</span> (i != 1)
00881     <span class="keywordflow">return</span> 0;
00882       i = net_read(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, buf, max);
00883     }
00884   <span class="keywordflow">if</span> (i == -1)
00885     <span class="keywordflow">return</span> 0;
00886   nData-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a> += i;
00887   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> &amp;&amp; nData-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>)
00888     {
00889       nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> += i;
00890       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> &gt; nData-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>)
00891         {
00892       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a>(nData, nData-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a>, nData-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a>) == 0)
00893         <span class="keywordflow">return</span> 0;
00894       nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> = 0;
00895         }
00896     }
00897   <span class="keywordflow">return</span> i;
00898 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="ftplib.c::FtpRename" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpRename </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dst</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01252 {
01253   <span class="keywordtype">char</span> cmd[256];
01254 
01255   <span class="keywordflow">if</span> (((strlen(src) + 7) &gt; <span class="keyword">sizeof</span>(cmd)) ||
01256       ((strlen(dst) + 7) &gt; <span class="keyword">sizeof</span>(cmd)))
01257     <span class="keywordflow">return</span> 0;
01258   sprintf(cmd,<span class="stringliteral">"RNFR %s"</span>,src);
01259   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(cmd,<span class="charliteral">'3'</span>,nControl))
01260     <span class="keywordflow">return</span> 0;
01261   sprintf(cmd,<span class="stringliteral">"RNTO %s"</span>,dst);
01262   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(cmd,<span class="charliteral">'2'</span>,nControl))
01263     <span class="keywordflow">return</span> 0;
01264   <span class="keywordflow">return</span> 1;
01265 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="ftplib.c::FtpRmdir" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpRmdir </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01060 {
01061   <span class="keywordtype">char</span> buf[256];
01062 
01063   <span class="keywordflow">if</span> ((strlen(path) + 6) &gt; <span class="keyword">sizeof</span>(buf))
01064     <span class="keywordflow">return</span> 0;
01065   sprintf(buf,<span class="stringliteral">"RMD %s"</span>,path);
01066   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>,nControl))
01067     <span class="keywordflow">return</span> 0;
01068   <span class="keywordflow">return</span> 1;
01069 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ftplib.c::FtpSendCmd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FtpSendCmd </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char&nbsp;</td>
          <td class="mdname" nowrap> <em>expresp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00536 {
00537   <span class="keywordtype">char</span> buf[256];
00538   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>)
00539     <span class="keywordflow">return</span> 0;
00540   <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a9">ftplib_debug</a> &gt; 2)
00541     fprintf(stderr,<span class="stringliteral">"%s\n"</span>,cmd);
00542   <span class="keywordflow">if</span> ((strlen(cmd) + 3) &gt; <span class="keyword">sizeof</span>(buf))
00543     <span class="keywordflow">return</span> 0;
00544   sprintf(buf,<span class="stringliteral">"%s\r\n"</span>,cmd);
00545   <span class="keywordflow">if</span> (net_write(nControl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>,buf,strlen(buf)) &lt;= 0)
00546     {
00547       perror(<span class="stringliteral">"write"</span>);
00548       <span class="keywordflow">return</span> 0;
00549     }
00550   <span class="keywordflow">return</span> <a class="code" href="ftplib_8c.html#a13">readresp</a>(expresp, nControl);
00551 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ftplib.c::FtpSite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpSite </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00974 {
00975   <span class="keywordtype">char</span> buf[256];
00976     
00977   <span class="keywordflow">if</span> ((strlen(cmd) + 7) &gt; <span class="keyword">sizeof</span>(buf))
00978     <span class="keywordflow">return</span> 0;
00979   sprintf(buf,<span class="stringliteral">"SITE %s"</span>,cmd);
00980   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(buf,<span class="charliteral">'2'</span>,nControl))
00981     <span class="keywordflow">return</span> 0;
00982   <span class="keywordflow">return</span> 1;
00983 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="ftplib.c::FtpSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpSize </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01182 {
01183   <span class="keywordtype">char</span> cmd[256];
01184   <span class="keywordtype">int</span> resp,sz,rv=1;
01185 
01186   <span class="keywordflow">if</span> ((strlen(path) + 7) &gt; <span class="keyword">sizeof</span>(cmd))
01187     <span class="keywordflow">return</span> 0;
01188   sprintf(cmd, <span class="stringliteral">"TYPE %c"</span>, mode);
01189   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(cmd, <span class="charliteral">'2'</span>, nControl))
01190     <span class="keywordflow">return</span> 0;
01191   sprintf(cmd,<span class="stringliteral">"SIZE %s"</span>,path);
01192   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(cmd,<span class="charliteral">'2'</span>,nControl))
01193     rv = 0;
01194   <span class="keywordflow">else</span>
01195     {
01196       <span class="keywordflow">if</span> (sscanf(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, <span class="stringliteral">"%d %d"</span>, &amp;resp, &amp;sz) == 2)
01197     *size = sz;
01198       <span class="keywordflow">else</span>
01199     rv = 0;
01200     }   
01201   <span class="keywordflow">return</span> rv;
01202 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ftplib.c::FtpSysType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpSysType </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00995 {
00996   <span class="keywordtype">int</span> l = max;
00997   <span class="keywordtype">char</span> *b = buf;
00998   <span class="keywordtype">char</span> *s;
00999   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a18">FtpSendCmd</a>(<span class="stringliteral">"SYST"</span>,<span class="charliteral">'2'</span>,nControl))
01000     <span class="keywordflow">return</span> 0;
01001   s = &amp;nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>[4];
01002   <span class="keywordflow">while</span> ((--l) &amp;&amp; (*s != <span class="charliteral">' '</span>))
01003     *b++ = *s++;
01004   *b++ = <span class="charliteral">'\0'</span>;
01005   <span class="keywordflow">return</span> 1;
01006 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ftplib.c::FtpWrite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int FtpWrite </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00904 {
00905   <span class="keywordtype">int</span> i;
00906   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>)
00907     <span class="keywordflow">return</span> 0;
00908   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>)
00909     i = <a class="code" href="ftplib_8c.html#a12">writeline</a>(buf, len, nData);
00910   <span class="keywordflow">else</span>
00911     {
00912       <a class="code" href="ftplib_8c.html#a10">socket_wait</a>(nData);
00913       i = net_write(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, buf, len);
00914     }
00915   <span class="keywordflow">if</span> (i == -1)
00916     <span class="keywordflow">return</span> 0;
00917   nData-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a> += i;
00918   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> &amp;&amp; nData-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>)
00919     {
00920       nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> += i;
00921       <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> &gt; nData-&gt;<a class="code" href="structNetBuf.html#o14">cbbytes</a>)
00922         {
00923       nData-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a>(nData, nData-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a>, nData-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a>);
00924       nData-&gt;<a class="code" href="structNetBuf.html#o15">xfered1</a> = 0;
00925         }
00926     }
00927   <span class="keywordflow">return</span> i;
00928 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="ftplib.c::FtpXfer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FtpXfer </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>localfile</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>typ</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>01100 {
01101   <span class="keywordtype">int</span> l,c;
01102   <span class="keywordtype">char</span> *dbuf;
01103   FILE *local = NULL;
01104   <a class="code" href="structNetBuf.html">netbuf</a> *nData;
01105   <span class="keywordtype">int</span> rv=1;
01106 
01107   <span class="keywordflow">if</span> (localfile != NULL)
01108     {
01109       <span class="keywordtype">char</span> ac[4] = <span class="stringliteral">"w"</span>;
01110       <span class="keywordflow">if</span> (typ == <a class="code" href="ftplib_8h.html#a4">FTPLIB_FILE_WRITE</a>)
01111     ac[0] = <span class="charliteral">'r'</span>;
01112       <span class="keywordflow">if</span> (mode == <a class="code" href="ftplib_8h.html#a6">FTPLIB_IMAGE</a>)
01113     ac[1] = <span class="charliteral">'b'</span>;
01114       local = fopen(localfile, ac);
01115       <span class="keywordflow">if</span> (local == NULL)
01116     {
01117       strncpy(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, strerror(errno),
01118           <span class="keyword">sizeof</span>(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>));
01119       <span class="keywordflow">return</span> 0;
01120     }
01121     }
01122   <span class="keywordflow">if</span> (local == NULL)
01123     local = (typ == <a class="code" href="ftplib_8h.html#a4">FTPLIB_FILE_WRITE</a>) ? stdin : stdout;
01124   <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a22">FtpAccess</a>(path, typ, mode, nControl, &amp;nData))
01125     <span class="keywordflow">return</span> 0;
01126   dbuf = malloc(FTPLIB_BUFSIZ);
01127   <span class="keywordflow">if</span> (typ == <a class="code" href="ftplib_8h.html#a4">FTPLIB_FILE_WRITE</a>)
01128     {
01129       <span class="keywordflow">while</span> ((l = fread(dbuf, 1, FTPLIB_BUFSIZ, local)) &gt; 0)
01130     <span class="keywordflow">if</span> ((c = <a class="code" href="ftplib_8c.html#a24">FtpWrite</a>(dbuf, l, nData)) &lt; l)
01131       {
01132         fprintf(stderr, <span class="stringliteral">"short write: passed %d, wrote %d\n"</span>, l, c);
01133         rv = 0;
01134         <span class="keywordflow">break</span>;
01135       }
01136     }
01137   <span class="keywordflow">else</span>
01138     {
01139       <span class="keywordflow">while</span> ((l = <a class="code" href="ftplib_8c.html#a23">FtpRead</a>(dbuf, FTPLIB_BUFSIZ, nData)) &gt; 0)
01140     <span class="keywordflow">if</span> (fwrite(dbuf, 1, l, local) &lt;= 0)
01141       {
01142         perror(<span class="stringliteral">"localfile write"</span>);
01143         rv = 0;
01144         <span class="keywordflow">break</span>;
01145       }
01146     }
01147   free(dbuf);
01148   fflush(local);
01149   <span class="keywordflow">if</span> (localfile != NULL)
01150     fclose(local);
01151   <a class="code" href="ftplib_8c.html#a25">FtpClose</a>(nData);
01152   <span class="keywordflow">return</span> rv;
01153 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ftplib.c::readline" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int readline </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ctl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00186 {
00187   <span class="keywordtype">int</span> x,retval = 0;
00188   <span class="keywordtype">char</span> *end,*bp=buf;
00189   <span class="keywordtype">int</span> eof = 0;
00190 
00191   <span class="keywordflow">if</span> ((ctl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>) &amp;&amp; (ctl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a5">FTPLIB_READ</a>))
00192     <span class="keywordflow">return</span> -1;
00193   <span class="keywordflow">if</span> (max == 0)
00194     <span class="keywordflow">return</span> 0;
00195   <span class="keywordflow">do</span>
00196     {
00197       <span class="keywordflow">if</span> (ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a> &gt; 0)
00198         {
00199       x = (max &gt;= ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a>) ? ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a> : max-1;
00200       end = memccpy(bp,ctl-&gt;<a class="code" href="structNetBuf.html#o1">cget</a>,<span class="charliteral">'\n'</span>,x);
00201       <span class="keywordflow">if</span> (end != NULL)
00202         x = end - bp;
00203       retval += x;
00204       bp += x;
00205       *bp = <span class="charliteral">'\0'</span>;
00206       max -= x;
00207       ctl-&gt;<a class="code" href="structNetBuf.html#o1">cget</a> += x;
00208       ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a> -= x;
00209       <span class="keywordflow">if</span> (end != NULL)
00210         {
00211           bp -= 2;
00212           <span class="keywordflow">if</span> (strcmp(bp,<span class="stringliteral">"\r\n"</span>) == 0)
00213         {
00214           *bp++ = <span class="charliteral">'\n'</span>;
00215           *bp++ = <span class="charliteral">'\0'</span>;
00216           --retval;
00217         }
00218           <span class="keywordflow">break</span>;
00219         }
00220         }
00221       <span class="keywordflow">if</span> (max == 1)
00222         {
00223       *buf = <span class="charliteral">'\0'</span>;
00224       <span class="keywordflow">break</span>;
00225         }
00226       <span class="keywordflow">if</span> (ctl-&gt;<a class="code" href="structNetBuf.html#o0">cput</a> == ctl-&gt;<a class="code" href="structNetBuf.html#o1">cget</a>)
00227         {
00228       ctl-&gt;<a class="code" href="structNetBuf.html#o0">cput</a> = ctl-&gt;<a class="code" href="structNetBuf.html#o1">cget</a> = ctl-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>;
00229       ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a> = 0;
00230       ctl-&gt;<a class="code" href="structNetBuf.html#o4">cleft</a> = <a class="code" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>;
00231         }
00232       <span class="keywordflow">if</span> (eof)
00233     {
00234       <span class="keywordflow">if</span> (retval == 0)
00235         retval = -1;
00236       <span class="keywordflow">break</span>;
00237     }
00238       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a10">socket_wait</a>(ctl))
00239     <span class="keywordflow">return</span> retval;
00240       <span class="keywordflow">if</span> ((x = net_read(ctl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>,ctl-&gt;<a class="code" href="structNetBuf.html#o0">cput</a>,ctl-&gt;<a class="code" href="structNetBuf.html#o4">cleft</a>)) == -1)
00241         {
00242       perror(<span class="stringliteral">"read"</span>);
00243       retval = -1;
00244       <span class="keywordflow">break</span>;
00245         }
00246       <span class="keywordflow">if</span> (x == 0)
00247     eof = 1;
00248       ctl-&gt;<a class="code" href="structNetBuf.html#o4">cleft</a> -= x;
00249       ctl-&gt;<a class="code" href="structNetBuf.html#o3">cavail</a> += x;
00250       ctl-&gt;<a class="code" href="structNetBuf.html#o0">cput</a> += x;
00251     }
00252   <span class="keywordflow">while</span> (1);
00253   <span class="keywordflow">return</span> retval;
00254 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ftplib.c::readresp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int readresp </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00323 {
00324   <span class="keywordtype">char</span> match[5];
00325   <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a11">readline</a>(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,256,nControl) == -1)
00326     {
00327       perror(<span class="stringliteral">"Control socket read failed"</span>);
00328       <span class="keywordflow">return</span> 0;
00329     }
00330   <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a9">ftplib_debug</a> &gt; 1)
00331     fprintf(stderr,<span class="stringliteral">"%s"</span>,nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>);
00332   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>[3] == <span class="charliteral">'-'</span>)
00333     {
00334       strncpy(match,nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,3);
00335       match[3] = <span class="charliteral">' '</span>;
00336       match[4] = <span class="charliteral">'\0'</span>;
00337       <span class="keywordflow">do</span>
00338     {
00339       <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a11">readline</a>(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,256,nControl) == -1)
00340         {
00341           perror(<span class="stringliteral">"Control socket read failed"</span>);
00342           <span class="keywordflow">return</span> 0;
00343         }
00344       <span class="keywordflow">if</span> (<a class="code" href="ftplib_8c.html#a9">ftplib_debug</a> &gt; 1)
00345         fprintf(stderr,<span class="stringliteral">"%s"</span>,nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>);
00346     }
00347       <span class="keywordflow">while</span> (strncmp(nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>,match,4));
00348     }
00349   <span class="keywordflow">if</span> (nControl-&gt;<a class="code" href="structNetBuf.html#o16">response</a>[0] == c)
00350     <span class="keywordflow">return</span> 1;
00351   <span class="keywordflow">return</span> 0;
00352 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ftplib.c::socket_wait" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int socket_wait </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ctl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00147 {
00148   fd_set fd,*rfd = NULL,*wfd = NULL;
00149   <span class="keyword">struct </span>timeval tv;
00150   <span class="keywordtype">int</span> rv = 0;
00151   <span class="keywordflow">if</span> ((ctl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> == <a class="code" href="ftplib_8c.html#a4">FTPLIB_CONTROL</a>) || (ctl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a> == NULL))
00152     <span class="keywordflow">return</span> 1;
00153   <span class="keywordflow">if</span> (ctl-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> == <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>)
00154     wfd = &amp;fd;
00155   <span class="keywordflow">else</span>
00156     rfd = &amp;fd;
00157   FD_ZERO(&amp;fd);
00158   <span class="keywordflow">do</span>
00159     {
00160       FD_SET(ctl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>,&amp;fd);
00161       tv = ctl-&gt;<a class="code" href="structNetBuf.html#o10">idletime</a>;
00162       rv = select(ctl-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>+1, rfd, wfd, NULL, &amp;tv);
00163       <span class="keywordflow">if</span> (rv == -1)
00164     {
00165       rv = 0;
00166       strncpy(ctl-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a>-&gt;<a class="code" href="structNetBuf.html#o16">response</a>, strerror(errno),
00167           <span class="keyword">sizeof</span>(ctl-&gt;<a class="code" href="structNetBuf.html#o7">ctrl</a>-&gt;<a class="code" href="structNetBuf.html#o16">response</a>));
00168       <span class="keywordflow">break</span>;
00169     }
00170       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rv &gt; 0)
00171     {
00172       rv = 1;
00173       <span class="keywordflow">break</span>;
00174     }
00175     }
00176   <span class="keywordflow">while</span> ((rv = ctl-&gt;<a class="code" href="structNetBuf.html#o11">idlecb</a>(ctl, ctl-&gt;<a class="code" href="structNetBuf.html#o13">xfered</a>, ctl-&gt;<a class="code" href="structNetBuf.html#o12">idlearg</a>)));
00177   <span class="keywordflow">return</span> rv;
00178 }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ftplib.c::writeline" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int writeline </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="structNetBuf.html">netbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
<div class="fragment"><pre>00262 {
00263   <span class="keywordtype">int</span> x, nb=0, w;
00264   <span class="keywordtype">char</span> *ubp = buf, *nbp;
00265   <span class="keywordtype">char</span> lc=0;
00266 
00267   <span class="keywordflow">if</span> (nData-&gt;<a class="code" href="structNetBuf.html#o6">dir</a> != <a class="code" href="ftplib_8c.html#a6">FTPLIB_WRITE</a>)
00268     <span class="keywordflow">return</span> -1;
00269   nbp = nData-&gt;<a class="code" href="structNetBuf.html#o5">buf</a>;
00270   <span class="keywordflow">for</span> (x=0; x &lt; len; x++)
00271     {
00272       <span class="keywordflow">if</span> ((*ubp == <span class="charliteral">'\n'</span>) &amp;&amp; (lc != <span class="charliteral">'\r'</span>))
00273     {
00274       <span class="keywordflow">if</span> (nb == <a class="code" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>)
00275         {
00276           <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a10">socket_wait</a>(nData))
00277         <span class="keywordflow">return</span> x;
00278           w = net_write(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, nbp, FTPLIB_BUFSIZ);
00279           <span class="keywordflow">if</span> (w != <a class="code" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>)
00280         {
00281           fprintf(stderr, <span class="stringliteral">"net_write(1) returned %d, errno = %d\n"</span>, w, errno);
00282           <span class="keywordflow">return</span>(-1);
00283         }
00284           nb = 0;
00285         }
00286       nbp[nb++] = <span class="charliteral">'\r'</span>;
00287     }
00288       <span class="keywordflow">if</span> (nb == <a class="code" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>)
00289     {
00290       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a10">socket_wait</a>(nData))
00291         <span class="keywordflow">return</span> x;
00292       w = net_write(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, nbp, FTPLIB_BUFSIZ);
00293       <span class="keywordflow">if</span> (w != <a class="code" href="ftplib_8c.html#a2">FTPLIB_BUFSIZ</a>)
00294         {
00295           fprintf(stderr, <span class="stringliteral">"net_write(2) returned %d, errno = %d\n"</span>, w, errno);
00296           <span class="keywordflow">return</span>(-1);
00297         }
00298       nb = 0;
00299     }
00300       nbp[nb++] = lc = *ubp++;
00301     }
00302   <span class="keywordflow">if</span> (nb)
00303     {
00304       <span class="keywordflow">if</span> (!<a class="code" href="ftplib_8c.html#a10">socket_wait</a>(nData))
00305     <span class="keywordflow">return</span> x;
00306       w = net_write(nData-&gt;<a class="code" href="structNetBuf.html#o2">handle</a>, nbp, nb);
00307       <span class="keywordflow">if</span> (w != nb)
00308     {
00309       fprintf(stderr, <span class="stringliteral">"net_write(3) returned %d, errno = %d\n"</span>, w, errno);
00310       <span class="keywordflow">return</span>(-1);
00311     }
00312     }
00313   <span class="keywordflow">return</span> len;
00314 }
</pre></div>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a9" doxytag="ftplib.c::ftplib_debug" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GLOBALDEF int <a class="el" href="ftplib_8h.html#a18">ftplib_debug</a> = 0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ftplib.c::version" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char* <a class="el" href="ftplib_8c.html#a8">version</a><code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre>
<span class="stringliteral">"ftplib Release 3.1-1 9/16/00, copyright 1996-2000 Thomas Pfau"</span>
</pre></div>    </td>
  </tr>
</table>
<hr><address><small>
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53></a>
<br>
FTPhone : Mon Jan 5 01:56:27 2004.

<!--
Generated at Mon Jan 5 01:56:27 2004 for FTPhone by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.4 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
-->
</body>
</html>
